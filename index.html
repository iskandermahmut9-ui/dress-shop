<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dress Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); }
        .filters { display: flex; gap: 10px; padding: 15px; overflow-x: auto; white-space: nowrap; background: var(--tg-theme-secondary-bg-color, #f0f0f0); position: sticky; top: 0; z-index: 100; }
        .filter-btn { padding: 8px 16px; border: none; border-radius: 20px; background: var(--tg-theme-button-color, #3390ec); color: #fff; font-size: 14px; cursor: pointer; opacity: 0.6; transition: 0.3s; }
        .filter-btn.active { opacity: 1; font-weight: bold; }
        .container { padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding-bottom: 80px; }
        .card { border-radius: 12px; overflow: hidden; background: var(--tg-theme-secondary-bg-color, #f5f5f5); position: relative; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .card-body { padding: 10px; display: flex; flex-direction: column; justify-content: space-between; flex-grow: 1; }
        .card-title { font-size: 14px; font-weight: 600; margin-bottom: 5px; }
        .card-desc { font-size: 12px; opacity: 0.8; margin-bottom: 8px; }
        .card-price { font-size: 15px; font-weight: bold; color: var(--tg-theme-button-color, #3390ec); }
        .add-btn { width: 100%; padding: 8px; margin-top: 5px; border: none; border-radius: 8px; background-color: var(--tg-theme-button-color, #3390ec); color: white; cursor: pointer; }
        .counter { position: absolute; top: 10px; right: 10px; background: #3390ec; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; display: none; }
        .main-btn { position: fixed; bottom: 15px; left: 15px; right: 15px; padding: 15px; border: none; border-radius: 12px; background: #31b545; color: white; font-size: 16px; font-weight: bold; text-transform: uppercase; display: none; cursor: pointer; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-align: center; }
    </style>
</head>
<body>

    <div class="filters">
        <button class="filter-btn active" onclick="filterProducts('all', this)">–í—Å–µ</button>
        <button class="filter-btn" onclick="filterProducts('adult', this)">–í–∑—Ä–æ—Å–ª—ã–µ</button>
        <button class="filter-btn" onclick="filterProducts('child_3_7', this)">–î–µ—Ç–∏ 3-7</button>
        <button class="filter-btn" onclick="filterProducts('child_10_13', this)">–î–µ—Ç–∏ 10-13</button>
    </div>

    <div class="container" id="products-container"></div>
    <div class="main-btn" id="order-btn" onclick="sendOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 

        // –¢–í–û–ô –ù–ò–ö–ù–ï–ô–ú (–±–µ–∑ @, —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–∏—Ç —Å–∞–º)
        const ADMIN_USERNAME = 'GavAlexandr'; 

        const products = [
            { id: 42, name: "–õ–æ—Ç 42 üå∏", desc: "–†–∞–∑–º–µ—Ä: 42-44", price: 2500, image: "img/dress1.jpg", category: "adult" },
            { id: 2, name: "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞", desc: "–†–æ—Å—Ç 116-122", price: 1500, image: "img/dress2.jpg", category: "child_3_7" },
            { id: 3, name: "–í–µ—á–µ—Ä–Ω–∏–π –±–ª–µ—Å–∫", desc: "–†–æ—Å—Ç 146-152", price: 1800, image: "img/dress3.jpg", category: "child_10_13" },
            { id: 4, name: "–ß–µ—Ä–Ω–æ–µ –±–∞—Ä—Ö–∞—Ç", desc: "–†–∞–∑–º–µ—Ä: 44-46", price: 3000, image: "img/dress4.jpg", category: "adult" }
        ];

        let cart = {};

        function renderProducts(filter = 'all') {
            const container = document.getElementById('products-container');
            container.innerHTML = "";
            const filtered = products.filter(p => filter === 'all' || p.category === filter);

            filtered.forEach(p => {
                const count = cart[p.id] ? cart[p.id].count : 0;
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="counter" style="display: ${count > 0 ? 'block' : 'none'}">${count}</div>
                    <img src="${p.image}" alt="${p.name}" onerror="this.src='https://placehold.co/300x400?text=Photo'">
                    <div class="card-body">
                        <div>
                            <div class="card-title">${p.name}</div>
                            <div class="card-desc">${p.desc}</div>
                        </div>
                        <div class="card-price">${p.price} ‚ÇΩ</div>
                        <button class="add-btn" onclick="addToCart(${p.id})">${count > 0 ? '–î–æ–±–∞–≤–∏—Ç—å ('+count+')' : '–í—ã–±—Ä–∞—Ç—å'}</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function filterProducts(category, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderProducts(category);
        }

        function addToCart(id) {
            if (!cart[id]) {
                const product = products.find(p => p.id === id);
                cart[id] = { ...product, count: 0 };
            }
            cart[id].count++;
            
            const activeBtn = document.querySelector('.filter-btn.active');
            const currentCategory = activeBtn.getAttribute('onclick').match(/'([^']+)'/)[1];
            
            renderProducts(currentCategory);
            updateMainButton();
        }

        function updateMainButton() {
            let total = 0;
            for (let id in cart) total += cart[id].price * cart[id].count;

            const btn = document.getElementById('order-btn');
            if (total > 0) {
                btn.style.display = "block";
                btn.innerText = `–û–§–û–†–ú–ò–¢–¨ –ê–†–ï–ù–î–£: ${total} ‚ÇΩ`;
            } else {
                btn.style.display = "none";
            }
        }

        function sendOrder() {
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
            let message = "–ó–ê–ö–ê–ó –ê–†–ï–ù–î–´ (Dress Shop):\n\n";
            let total = 0;
            for (let id in cart) {
                const p = cart[id];
                if (p.count > 0) {
                    message += `üëó ${p.name} (${p.desc})\n   –ö–æ–ª-–≤–æ: ${p.count} —à—Ç.\n   –¶–µ–Ω–∞: ${p.price * p.count} ‚ÇΩ\n\n`;
                    total += p.price * p.count;
                }
            }
            message += `üí∞ –ò–¢–û–ì–û: ${total} ‚ÇΩ`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            tg.showPopup({
                title: '–í–∞—à –∑–∞–∫–∞–∑',
                message: `–°—É–º–º–∞: ${total} ‚ÇΩ\n\n–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å", —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç.`,
                buttons: [
                    {id: 'go', type: 'default', text: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'},
                    {id: 'cancel', type: 'destructive', text: '–û—Ç–º–µ–Ω–∞'}
                ]
            }, function(btnId) {
                if (btnId === 'go') {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
                    const url = `https://t.me/${ADMIN_USERNAME}?text=${encodeURIComponent(message)}`;
                    
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ Telegram WebApp
                    tg.openTelegramLink(url);
                }
            });
        }

        renderProducts();
    </script>
</body>
</html>