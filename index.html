<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ç–∞–ª–æ–≥ –ü–ª–∞—Ç—å–µ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .filters {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto; /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞, –µ—Å–ª–∏ –∫–Ω–æ–ø–æ–∫ –º–Ω–æ–≥–æ */
            white-space: nowrap;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            font-size: 14px;
            cursor: pointer;
            opacity: 0.6; /* –ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —á—É—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è */
            transition: 0.3s;
        }

        .filter-btn.active {
            opacity: 1; /* –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —è—Ä–∫–∞—è */
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .container { padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding-bottom: 80px; }
        
        .card { border-radius: 12px; overflow: hidden; background: var(--tg-theme-secondary-bg-color, #f5f5f5); position: relative; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .card-title { font-size: 14px; font-weight: 600; margin-bottom: 5px; }
        .card-desc { font-size: 12px; opacity: 0.8; margin-bottom: 8px; }
        .card-price { font-size: 15px; font-weight: bold; color: var(--tg-theme-button-color, #3390ec); }
        
        /* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å */
        .add-btn { width: 100%; padding: 8px; margin-top: 5px; border: none; border-radius: 8px; background-color: var(--tg-theme-button-color, #3390ec); color: white; cursor: pointer; }
        
        /* –°—á–µ—Ç—á–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä–µ */
        .counter { position: absolute; top: 10px; right: 10px; background: #3390ec; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; display: none; }
        
        /* –ù–∏–∂–Ω—è—è –∫–Ω–æ–ø–∫–∞ –∑–∞–∫–∞–∑–∞ */
        .main-btn { position: fixed; bottom: 10px; left: 10px; right: 10px; padding: 15px; border: none; border-radius: 12px; background: #31b545; color: white; font-size: 16px; font-weight: bold; text-transform: uppercase; display: none; cursor: pointer; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <div class="filters">
        <button class="filter-btn active" onclick="filterProducts('all', this)">–í—Å–µ</button>
        <button class="filter-btn" onclick="filterProducts('adult', this)">–í–∑—Ä–æ—Å–ª—ã–µ</button>
        <button class="filter-btn" onclick="filterProducts('child_3_7', this)">–î–µ—Ç–∏ 3-7 –ª–µ—Ç</button>
        <button class="filter-btn" onclick="filterProducts('child_10_13', this)">–î–µ—Ç–∏ 10-13 –ª–µ—Ç</button>
    </div>

    <div class="container" id="products-container"></div>

    <button class="main-btn" id="order-btn" onclick="sendOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 

        // === –ë–ê–ó–ê –î–ê–ù–ù–´–• ===
        // category: 'adult', 'child_3_7', 'child_10_13'
        const products = [
            {
                id: 42,
                name: "–õ–æ—Ç 42 üå∏",
                desc: "–†–∞–∑–º–µ—Ä: 42-44",
                price: 2500,
                image: "img/dress1.jpg", // –ù–µ –∑–∞–±—É–¥—å –∑–∞–∫–∏–Ω—É—Ç—å dress1.jpg –≤ –ø–∞–ø–∫—É img
                category: "adult" 
            },
            {
                id: 2,
                name: "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞ (–†–æ–∑–æ–≤–æ–µ)",
                desc: "–†–æ—Å—Ç 116-122",
                price: 1500,
                image: "img/dress2.jpg",
                category: "child_3_7"
            },
            {
                id: 3,
                name: "–í–µ—á–µ—Ä–Ω–∏–π –±–ª–µ—Å–∫",
                desc: "–†–æ—Å—Ç 146-152",
                price: 1800,
                image: "img/dress3.jpg",
                category: "child_10_13"
            },
            {
                id: 4,
                name: "–ß–µ—Ä–Ω–æ–µ –±–∞—Ä—Ö–∞—Ç–Ω–æ–µ",
                desc: "–†–∞–∑–º–µ—Ä: 44-46",
                price: 3000,
                image: "img/dress4.jpg",
                category: "adult"
            }
        ];

        let cart = {};

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
        function renderProducts(filter = 'all') {
            const container = document.getElementById('products-container');
            container.innerHTML = ""; // –û—á–∏—â–∞–µ–º

            // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ø–∏—Å–æ–∫
            const filtered = products.filter(p => filter === 'all' || p.category === filter);

            filtered.forEach(p => {
                const count = cart[p.id] ? cart[p.id].count : 0;
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="counter" style="display: ${count > 0 ? 'block' : 'none'}">${count} —à—Ç</div>
                    <img src="${p.image}" alt="${p.name}" onerror="this.src='https://placehold.co/300x400?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'">
                    <div class="card-body">
                        <div>
                            <div class="card-title">${p.name}</div>
                            <div class="card-desc">${p.desc}</div>
                        </div>
                        <div class="card-price">${p.price.toLocaleString()} ‚ÇΩ</div>
                        <button class="add-btn" onclick="addToCart(${p.id})">
                            ${count > 0 ? '–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë' : '–í—ã–±—Ä–∞—Ç—å'}
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function filterProducts(category, btn) {
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞
            renderProducts(category);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
        function addToCart(id) {
            if (!cart[id]) {
                const product = products.find(p => p.id === id);
                cart[id] = { ...product, count: 0 };
            }
            cart[id].count++;
            
            // –ù–∞—Ö–æ–¥–∏–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ñ–∏–ª—å—Ç—Ä–∞, —á—Ç–æ–±—ã –Ω–µ —Å–±–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
            const activeBtn = document.querySelector('.filter-btn.active');
            const currentCategory = activeBtn.getAttribute('onclick').match(/'([^']+)'/)[1];
            
            renderProducts(currentCategory);
            updateMainButton();
        }

        // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫–∞–∑–∞
        function updateMainButton() {
            let total = 0;
            for (let id in cart) total += cart[id].price * cart[id].count;

            const btn = document.getElementById('order-btn');
            if (total > 0) {
                btn.style.display = "block";
                btn.innerText = `–û–§–û–†–ú–ò–¢–¨ –ê–†–ï–ù–î–£ –ù–ê ${total.toLocaleString()} ‚ÇΩ`;
            } else {
                btn.style.display = "none";
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –±–æ—Ç–∞
        function sendOrder() {
            let items = [];
            let total = 0;
            for (let id in cart) {
                const p = cart[id];
                items.push(`${p.name} (${p.desc}) x${p.count} - ${p.price * p.count}—Ä`);
                total += p.price * p.count;
            }
            const data = { items: items, total: total };
            tg.sendData(JSON.stringify(data));
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        renderProducts();

    </script>
</body>
</html>